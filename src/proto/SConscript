#  -*- mode: python -*-

import os

env = Environment(
    ENV = {'PATH' : os.environ['PATH']},
    CPPFLAGS = ['-I.'],
    tools=['default', 'protoc']
    )

proto_files = env.Protoc(
    [],
    [
      "block.proto",
      "bundle-manifest.proto",
      "snapshot.proto",
      "file.proto",
      "glacier.proto",
      "http.proto",
    ],
    PROTOCPROTOPATH=['.'],
    PROTOCPYTHONOUTDIR=None, # set to None to not generate python
    PROTOCOUTDIR = '.', # defaults to same directory as .proto
)
Default(proto_files)

### Libraries

block_proto = env.Library(
    target='block_proto',
    source=[
        'block.pb.cc',
        ],
    LIBS=[
        'protobuf'
        ],
    )
Depends(block_proto, proto_files)

block_proto = env.Library(
    target='bundle_manifest_proto',
    source=[
        'bundle-manifest.pb.cc',
        ],
    LIBS=[
         block_proto,
        'protobuf'
        ],
    )
Depends(block_proto, proto_files)

file_proto = env.Library(
    target='file_proto',
    source=[
        'file.pb.cc',
        ],
    LIBS=[
        'protobuf'
        ],
    )
Depends(file_proto, proto_files)

glacier_proto = env.Library(
    target='glacier_proto',
    source=[
        'glacier.pb.cc',
        ],
    LIBS=[
        'protobuf'
        ],
    )
Depends(glacier_proto, proto_files)

http_proto = env.Library(
    target='http_proto',
    source=[
        'http.pb.cc',
        ],
    LIBS=[
        'protobuf'
        ],
    )
Depends(http_proto, proto_files)

snapshot_proto = env.Library(
    target='snapshot_proto',
    source=[
        'snapshot.pb.cc',
        ],
    LIBS=[
        block_proto,
        file_proto,
        'protobuf'
        ],
    )
Depends(snapshot_proto, proto_files)




